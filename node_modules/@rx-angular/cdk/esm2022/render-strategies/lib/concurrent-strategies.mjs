import { coalescingManager } from '@rx-angular/cdk/coalescing';
import { cancelCallback, forceFrameRate, scheduleCallback, } from '@rx-angular/cdk/internals/scheduler';
import { Observable } from 'rxjs';
import { filter, mapTo, switchMap } from 'rxjs/operators';
// set default to 60fps
forceFrameRate(60);
const immediateStrategy = {
    name: 'immediate',
    work: (cdRef) => cdRef.detectChanges(),
    behavior: ({ work, scope, ngZone }) => {
        return (o$) => o$.pipe(scheduleOnQueue(work, {
            ngZone,
            priority: 1 /* PriorityLevel.ImmediatePriority */,
            scope,
        }));
    },
};
const userBlockingStrategy = {
    name: 'userBlocking',
    work: (cdRef) => cdRef.detectChanges(),
    behavior: ({ work, scope, ngZone }) => {
        return (o$) => o$.pipe(scheduleOnQueue(work, {
            ngZone,
            priority: 2 /* PriorityLevel.UserBlockingPriority */,
            scope,
        }));
    },
};
const normalStrategy = {
    name: 'normal',
    work: (cdRef) => cdRef.detectChanges(),
    behavior: ({ work, scope, ngZone }) => {
        return (o$) => o$.pipe(scheduleOnQueue(work, {
            ngZone,
            priority: 3 /* PriorityLevel.NormalPriority */,
            scope,
        }));
    },
};
const lowStrategy = {
    name: 'low',
    work: (cdRef) => cdRef.detectChanges(),
    behavior: ({ work, scope, ngZone }) => {
        return (o$) => o$.pipe(scheduleOnQueue(work, {
            ngZone,
            priority: 4 /* PriorityLevel.LowPriority */,
            scope,
        }));
    },
};
const idleStrategy = {
    name: 'idle',
    work: (cdRef) => cdRef.detectChanges(),
    behavior: ({ work, scope, ngZone }) => {
        return (o$) => o$.pipe(scheduleOnQueue(work, {
            ngZone,
            priority: 5 /* PriorityLevel.IdlePriority */,
            scope,
        }));
    },
};
function scheduleOnQueue(work, options) {
    const scope = options.scope || {};
    return (o$) => o$.pipe(filter(() => !coalescingManager.isCoalescing(scope)), switchMap((v) => new Observable((subscriber) => {
        coalescingManager.add(scope);
        const task = scheduleCallback(options.priority, () => {
            work();
            coalescingManager.remove(scope);
            subscriber.next(v);
        }, { delay: options.delay, ngZone: options.ngZone });
        return () => {
            coalescingManager.remove(scope);
            cancelCallback(task);
        };
    }).pipe(mapTo(v))));
}
export const RX_CONCURRENT_STRATEGIES = {
    immediate: immediateStrategy,
    userBlocking: userBlockingStrategy,
    normal: normalStrategy,
    low: lowStrategy,
    idle: idleStrategy,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uY3VycmVudC1zdHJhdGVnaWVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jZGsvcmVuZGVyLXN0cmF0ZWdpZXMvc3JjL2xpYi9jb25jdXJyZW50LXN0cmF0ZWdpZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLGlCQUFpQixFQUFpQixNQUFNLDRCQUE0QixDQUFDO0FBQzlFLE9BQU8sRUFDTCxjQUFjLEVBQ2QsY0FBYyxFQUVkLGdCQUFnQixHQUNqQixNQUFNLHFDQUFxQyxDQUFDO0FBQzdDLE9BQU8sRUFBNEIsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVELE9BQU8sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTzFELHVCQUF1QjtBQUN2QixjQUFjLENBQUMsRUFBRSxDQUFDLENBQUM7QUFFbkIsTUFBTSxpQkFBaUIsR0FBMEI7SUFDL0MsSUFBSSxFQUFFLFdBQVc7SUFDakIsSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFO0lBQ3RDLFFBQVEsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1FBQ3BDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUNaLEVBQUUsQ0FBQyxJQUFJLENBQ0wsZUFBZSxDQUFDLElBQUksRUFBRTtZQUNwQixNQUFNO1lBQ04sUUFBUSx5Q0FBaUM7WUFDekMsS0FBSztTQUNOLENBQUMsQ0FDSCxDQUFDO0lBQ04sQ0FBQztDQUNGLENBQUM7QUFFRixNQUFNLG9CQUFvQixHQUEwQjtJQUNsRCxJQUFJLEVBQUUsY0FBYztJQUNwQixJQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUU7SUFDdEMsUUFBUSxFQUFFLENBQUMsRUFBRSxJQUFJ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LEtBQUssQ0FBQyxDQUFDO1lBQ2hDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ2xCLENBQ0YsQ0FBQztBQUNOLENBQUM7QUFJRCxNQUFNLENBQUMsTUFBTSx3QkFBd0IsR0FBMkI7SUFDOUQsU0FBUyxFQUFFLGlCQUFpQjtJQUM1QixZQUFZLEVBQUUsb0JBQW9CO0lBQ2xDLE1BQU0sRUFBRSxjQUFjO0lBQ3RCLEdBQUcsRUFBRSxXQUFXO0lBQ2hCLElBQUksRUFBRSxZQUFZO0NBQ25CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvYWxlc2NpbmdNYW5hZ2VyLCBjb2FsZXNjaW5nT2JqIH0gZnJvbSAnQHJ4LWFuZ3VsYXIvY2RrL2NvYWxlc2NpbmcnO1xuaW1wb3J0IHtcbiAgY2FuY2VsQ2FsbGJhY2ssXG4gIGZvcmNlRnJhbWVSYXRlLFxuICBQcmlvcml0eUxldmVsLFxuICBzY2hlZHVsZUNhbGxiYWNrLFxufSBmcm9tICdAcngtYW5ndWxhci9jZGsvaW50ZXJuYWxzL3NjaGVkdWxlcic7XG5pbXBvcnQgeyBNb25vVHlwZU9wZXJhdG9yRnVuY3Rpb24sIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwVG8sIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIFJ4Q29uY3VycmVudFN0cmF0ZWd5TmFtZXMsXG4gIFJ4Q3VzdG9tU3RyYXRlZ3lDcmVkZW50aWFscyxcbiAgUnhTdHJhdGVneUNyZWRlbnRpYWxzLFxufSBmcm9tICcuL21vZGVsJztcblxuLy8gc2V0IGRlZmF1bHQgdG8gNjBmcHNcbmZvcmNlRnJhbWVSYXRlKDYwKTtcblxuY29uc3QgaW1tZWRpYXRlU3RyYXRlZ3k6IFJ4U3RyYXRlZ3lDcmVkZW50aWFscyA9IHtcbiAgbmFtZTogJ2ltbWVkaWF0ZScsXG4gIHdvcms6IChjZFJlZikgPT4gY2RSZWYuZGV0ZWN0Q2hhbmdlcygpLFxuICBiZWhhdmlvcjogKHsgd29yaywgc2NvcGUsIG5nWm9uZSB9KSA9PiB7XG4gICAgcmV0dXJuIChvJCkgPT5cbiAgICAgIG8kLnBpcGUoXG4gICAgICAgIHNjaGVkdWxlT25RdWV1ZSh3b3JrLCB7XG4gICAgICAgICAgbmdab25lLFxuICAgICAgICAgIHByaW9yaXR5OiBQcmlvcml0eUxldmVsLkltbWVkaWF0ZVByaW9yaXR5LFxuICAgICAgICAgIHNjb3BlLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfSxcbn07XG5cbmNvbnN0IHVzZXJCbG9ja2luZ1N0cmF0ZWd5OiBSeFN0cmF0ZWd5Q3JlZGVudGlhbHMgPSB7XG4gIG5hbWU6ICd1c2VyQmxvY2tpbmcnLFxuICB3b3JrOiAoY2RSZWYpID0+IGNkUmVmLmRldGVjdENoYW5nZXMoKSxcbiAgYmVoYXZpb3I6ICh7IHdvcmssIHNjb3BlLCBuZ1pvbmUgfSkgPT4ge1xuICAgIHJldHVybiAobyQpID0+XG4gICAgICBvJC5waXBlKFxuICAgICAgICBzY2hlZHVsZU9uUXVldWUod29yaywge1xuICAgICAgICAgIG5nWm9uZSxcbiAgICAgICAgICBwcmlvcml0eTogUHJpb3JpdHlMZXZlbC5Vc2VyQmxvY2tpbmdQcmlvcml0eSxcbiAgICAgICAgICBzY29wZSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH0sXG59O1xuXG5jb25zdCBub3JtYWxTdHJhdGVneTogUnhTdHJhdGVneUNyZWRlbnRpYWxzID0ge1xuICBuYW1lOiAnbm9ybWFsJyxcbiAgd29yazogKGNkUmVmKSA9PiBjZFJlZi5kZXRlY3RDaGFuZ2VzKCksXG4gIGJlaGF2aW9yOiAoeyB3b3JrLCBzY29wZSwgbmdab25lIH0pID0+IHtcbiAgICByZXR1cm4gKG8kKSA9PlxuICAgICAgbyQucGlwZShcbiAgICAgICAgc2NoZWR1bGVPblF1ZXVlKHdvcmssIHtcbiAgICAgICAgICBuZ1pvbmUsXG4gICAgICAgICAgcHJpb3JpdHk6IFByaW9yaXR5TGV2ZWwuTm9ybWFsUHJpb3JpdHksXG4gICAgICAgICAgc2NvcGUsXG4gICAgICAgIH0pXG4gICAgICApO1xuICB9LFxufTtcblxuY29uc3QgbG93U3RyYXRlZ3k6IFJ4U3RyYXRlZ3lDcmVkZW50aWFscyA9IHtcbiAgbmFtZTogJ2xvdycsXG4gIHdvcms6IChjZFJlZikgPT4gY2RSZWYuZGV0ZWN0Q2hhbmdlcygpLFxuICBiZWhhdmlvcjogKHsgd29yaywgc2NvcGUsIG5nWm9uZSB9KSA9PiB7XG4gICAgcmV0dXJuIChvJCkgPT5cbiAgICAgIG8kLnBpcGUoXG4gICAgICAgIHNjaGVkdWxlT25RdWV1ZSh3b3JrLCB7XG4gICAgICAgICAgbmdab25lLFxuICAgICAgICAgIHByaW9yaXR5OiBQcmlvcml0eUxldmVsLkxvd1ByaW9yaXR5LFxuICAgICAgICAgIHNjb3BlLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfSxcbn07XG5cbmNvbnN0IGlkbGVTdHJhdGVneTogUnhTdHJhdGVneUNyZWRlbnRpYWxzID0ge1xuICBuYW1lOiAnaWRsZScsXG4gIHdvcms6IChjZFJlZikgPT4gY2RSZWYuZGV0ZWN0Q2hhbmdlcygpLFxuICBiZWhhdmlvcjogKHsgd29yaywgc2NvcGUsIG5nWm9uZSB9KSA9PiB7XG4gICAgcmV0dXJuIChvJCkgPT5cbiAgICAgIG8kLnBpcGUoXG4gICAgICAgIHNjaGVkdWxlT25RdWV1ZSh3b3JrLCB7XG4gICAgICAgICAgbmdab25lLFxuICAgICAgICAgIHByaW9yaXR5OiBQcmlvcml0eUxldmVsLklkbGVQcmlvcml0eSxcbiAgICAgICAgICBzY29wZSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH0sXG59O1xuXG5mdW5jdGlvbiBzY2hlZHVsZU9uUXVldWU8VD4oXG4gIHdvcms6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCxcbiAgb3B0aW9uczoge1xuICAgIHByaW9yaXR5OiBQcmlvcml0eUxldmVsO1xuICAgIHNjb3BlOiBjb2FsZXNjaW5nT2JqO1xuICAgIGRlbGF5PzogbnVtYmVyO1xuICAgIG5nWm9uZTogTmdab25lO1xuICB9XG4pOiBNb25vVHlwZU9wZXJhdG9yRnVuY3Rpb248VD4ge1xuICBjb25zdCBzY29wZSA9IChvcHRpb25zLnNjb3BlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KSB8fCB7fTtcbiAgcmV0dXJuIChvJDogT2JzZXJ2YWJsZTxUPik6IE9ic2VydmFibGU8VD4gPT5cbiAgICBvJC5waXBlKFxuICAgICAgZmlsdGVyKCgpID0+ICFjb2FsZXNjaW5nTWFuYWdlci5pc0NvYWxlc2Npbmcoc2NvcGUpKSxcbiAgICAgIHN3aXRjaE1hcCgodikgPT5cbiAgICAgICAgbmV3IE9ic2VydmFibGU8VD4oKHN1YnNjcmliZXIpID0+IHtcbiAgICAgICAgICBjb2FsZXNjaW5nTWFuYWdlci5hZGQoc2NvcGUpO1xuICAgICAgICAgIGNvbnN0IHRhc2sgPSBzY2hlZHVsZUNhbGxiYWNrKFxuICAgICAgICAgICAgb3B0aW9ucy5wcmlvcml0eSxcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgd29yaygpO1xuICAgICAgICAgICAgICBjb2FsZXNjaW5nTWFuYWdlci5yZW1vdmUoc2NvcGUpO1xuICAgICAgICAgICAgICBzdWJzY3JpYmVyLm5leHQodik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBkZWxheTogb3B0aW9ucy5kZWxheSwgbmdab25lOiBvcHRpb25zLm5nWm9uZSB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgY29hbGVzY2luZ01hbmFnZXIucmVtb3ZlKHNjb3BlKTtcbiAgICAgICAgICAgIGNhbmNlbENhbGxiYWNrKHRhc2spO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pLnBpcGUobWFwVG8odikpXG4gICAgICApXG4gICAgKTtcbn1cblxuZXhwb3J0IHR5cGUgUnhDb25jdXJyZW50U3RyYXRlZ2llcyA9XG4gIFJ4Q3VzdG9tU3RyYXRlZ3lDcmVkZW50aWFsczxSeENvbmN1cnJlbnRTdHJhdGVneU5hbWVzPjtcbmV4cG9ydCBjb25zdCBSWF9DT05DVVJSRU5UX1NUUkFURUdJRVM6IFJ4Q29uY3VycmVudFN0cmF0ZWdpZXMgPSB7XG4gIGltbWVkaWF0ZTogaW1tZWRpYXRlU3RyYXRlZ3ksXG4gIHVzZXJCbG9ja2luZzogdXNlckJsb2NraW5nU3RyYXRlZ3ksXG4gIG5vcm1hbDogbm9ybWFsU3RyYXRlZ3ksXG4gIGxvdzogbG93U3RyYXRlZ3ksXG4gIGlkbGU6IGlkbGVTdHJhdGVneSxcbn07XG4iXX0=