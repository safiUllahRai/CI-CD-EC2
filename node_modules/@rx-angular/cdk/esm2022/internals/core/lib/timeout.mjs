import { Observable } from 'rxjs';
import { concatMap, mapTo } from 'rxjs/operators';
import { getZoneUnPatchedApi } from './get-zone-unpatched-api';
/**
 * Creates an Observable that emits after a setTimeout.
 * The timeout it unpatched to not avoid zone pollution
 * @param setTimeoutFn
 */
function timeout(delay = 0) {
    return new Observable((subscriber) => {
        const asyncID = getZoneUnPatchedApi('setTimeout')(() => subscriber.next(0), delay);
        return () => {
            getZoneUnPatchedApi('clearTimeout')(asyncID);
        };
    });
}
/**
 *
 */
export function timeoutSwitchMapWith() {
    return (o$) => o$.pipe(concatMap((v) => timeout().pipe(mapTo(v))));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZW91dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvY2RrL2ludGVybmFscy9jb3JlL3NyYy9saWIvdGltZW91dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzlDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFL0Q7Ozs7R0FJRztBQUNILFNBQVMsT0FBTyxDQUFDLEtBQUssR0FBRyxDQUFDO0lBQ3hCLE9BQU8sSUFBSSxVQUFVLENBQVMsQ0FBQyxVQUE4QixFQUFFLEVBQUU7UUFDL0QsTUFBTSxPQUFPLEdBQUcsbUJBQW1CLENBQUMsWUFBWSxDQUFDLENBQy9DLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ3hCLEtBQUssQ0FDTixDQUFDO1FBQ0YsT0FBTyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxjQUFjLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRDs7R0FFRztBQUNILE1BQU0sVUFBVSxvQkFBb0I7SUFDbEMsT0FBTyxDQUFDLEVBQWlCLEVBQUUsRUFBRSxDQUMzQixFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaWJlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY29uY2F0TWFwLCBtYXBUbyB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGdldFpvbmVVblBhdGNoZWRBcGkgfSBmcm9tICcuL2dldC16b25lLXVucGF0Y2hlZC1hcGknO1xuXG4vKipcbiAqIENyZWF0ZXMgYW4gT2JzZXJ2YWJsZSB0aGF0IGVtaXRzIGFmdGVyIGEgc2V0VGltZW91dC5cbiAqIFRoZSB0aW1lb3V0IGl0IHVucGF0Y2hlZCB0byBub3QgYXZvaWQgem9uZSBwb2xsdXRpb25cbiAqIEBwYXJhbSBzZXRUaW1lb3V0Rm5cbiAqL1xuZnVuY3Rpb24gdGltZW91dChkZWxheSA9IDApIHtcbiAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPG51bWJlcj4oKHN1YnNjcmliZXI6IFN1YnNjcmliZXI8bnVtYmVyPikgPT4ge1xuICAgIGNvbnN0IGFzeW5jSUQgPSBnZXRab25lVW5QYXRjaGVkQXBpKCdzZXRUaW1lb3V0JykoXG4gICAgICAoKSA9PiBzdWJzY3JpYmVyLm5leHQoMCksXG4gICAgICBkZWxheVxuICAgICk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGdldFpvbmVVblBhdGNoZWRBcGkoJ2NsZWFyVGltZW91dCcpKGFzeW5jSUQpO1xuICAgIH07XG4gIH0pO1xufVxuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0aW1lb3V0U3dpdGNoTWFwV2l0aDxUPigpIHtcbiAgcmV0dXJuIChvJDogT2JzZXJ2YWJsZTxUPikgPT5cbiAgICBvJC5waXBlKGNvbmNhdE1hcCgodikgPT4gdGltZW91dCgpLnBpcGUobWFwVG8odikpKSk7XG59XG4iXX0=